
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulations de Prêt - Banque BeLeaza</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <div class="container">
            <a href="/" class="logo">Banque<span>BeLeaza</span></a>
            <nav class="main-nav">
                <ul>
                    <li><a href="/">Accueil</a></li>
                    <li><a href="/login.html">Espace Admin</a></li>
                    <li><a href="/client.html">Espace Client</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container mt-5 pt-5">
        <h1>Simulations de Prêt Sauvegardées</h1>
        <div id="simulations-list" class="accordion mt-4"></div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <div class="footer-cols">
                <div>
                    <h4>À Propos</h4>
                    <p>Votre partenaire financier de confiance.</p>
                </div>
                <div>
                    <h4>Contact</h4>
                    <p>Email: contact@beleaza.com</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Banque BeLeaza. Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const apiBase = "http://localhost:8000";

        function ajax(method, url, data, callback) {
            const xhr = new XMLHttpRequest();
            xhr.open(method, apiBase + url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = () => {
                if (xhr.readyState === 4) {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        callback(JSON.parse(xhr.responseText));
                    } else {
                        alert(`Erreur: ${xhr.responseText}`);
                    }
                }
            };
            xhr.send(JSON.stringify(data));
        }

        function loadSimulations() {
            ajax("GET", "/prets/simulations", null, (data) => {
                const accordion = document.getElementById('simulations-list');
                accordion.innerHTML = "";
                const simulationsByGroup = data.reduce((acc, row) => {
                    (acc[row.simulation_group_id] = acc[row.simulation_group_id] || []).push(row);
                    return acc;
                }, {});

                for (const groupId in simulationsByGroup) {
                    const simulationRows = simulationsByGroup[groupId];
                    const firstRow = simulationRows[0];
                    const savedBy = firstRow.client_nom ? `Client: ${firstRow.client_nom}` : 'Admin';
                    const accordionItem = document.createElement('div');
                    accordionItem.className = 'accordion-item';
                    accordionItem.innerHTML = `
                        <h2 class="accordion-header" id="heading-${groupId}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-${groupId}" aria-expanded="false" aria-controls="collapse-${groupId}">
                                Simulation du ${new Date(firstRow.created_at).toLocaleDateString()} - ${savedBy}
                            </button>
                        </h2>
                        <div id="collapse-${groupId}" class="accordion-collapse collapse" aria-labelledby="heading-${groupId}" data-bs-parent="#simulations-list">
                            <div class="accordion-body">
                                <table class="table table-sm table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Période</th>
                                            <th>Solde Début</th>
                                            <th>Annuité</th>
                                            <th>Intérêt Payé</th>
                                            <th>Assurance Payée</th>
                                            <th>Principal Payé</th>
                                            <th>Solde Fin</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${simulationRows.map(row => `
                                            <tr>
                                                <td>${row.periode}</td>
                                                <td>${row.solde_debut} €</td>
                                                <td>${row.annuite} €</td>
                                                <td>${row.interet_paye} €</td>
                                                <td>${row.assurance_paye} €</td>
                                                <td>${row.principal_paye} €</td>
                                                <td>${row.solde_fin} €</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                    accordion.appendChild(accordionItem);
                }
            });
        }

        document.addEventListener('DOMContentLoaded', loadSimulations);
    </script>
</body>
</html>
